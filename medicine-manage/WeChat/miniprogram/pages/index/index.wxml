<!--pages/index/index.wxml-->
<view class="container">
  <!-- å¼‚å¸¸é¢„è­¦æ¨ªå¹… -->
  <view wx:if="{{abnormalAlerts.length > 0}}" class="alert-banner" wx:for="{{abnormalAlerts}}" wx:key="id" bindtap="handleAlertTap" data-alert="{{item}}">
    <text class="alert-banner-icon">âš ï¸</text>
    <view class="alert-banner-content">
      <view class="alert-banner-title">{{item.alertType}}</view>
      <view class="alert-banner-desc">{{item.alertTime}} {{item.alertValue}}</view>
    </view>
    <text class="list-item-arrow">â€º</text>
  </view>

  <!-- ä»Šæ—¥ç»Ÿè®¡ -->
  <view class="stat-card fade-in">
    <view class="stat-card-header">
      <text class="stat-card-title">ä»Šæ—¥æµ‹é‡</text>
      <text class="text-small">{{today}}</text>
    </view>
    <view class="stat-card-value text-number">
      {{todayMeasureCount}}
      <text class="stat-card-unit">æ¬¡</text>
    </view>
    <view class="stat-card-footer">
      <text>è¡€ç³–: {{todayGlucoseCount}}æ¬¡</text>
      <text>è¡€å‹: {{todayPressureCount}}æ¬¡</text>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <button class="quick-action-item" bindtap="navigateToRecordGlucose">
      <text class="quick-action-icon">ğŸ©¸</text>
      <text class="quick-action-title">è®°å½•è¡€ç³–</text>
    </button>
    <button class="quick-action-item" bindtap="navigateToRecordPressure">
      <text class="quick-action-icon">â¤ï¸</text>
      <text class="quick-action-title">è®°å½•è¡€å‹</text>
    </button>
  </view>

  <!-- ä»Šæ—¥è¡€ç³–è®°å½• -->
  <view class="card fade-in">
    <view class="card-header">
      <text class="card-title">ä»Šæ—¥è¡€ç³–</text>
      <text class="view-all" bindtap="viewTrendGlucose">æŸ¥çœ‹è¶‹åŠ¿ â€º</text>
    </view>
    <view wx:if="{{todayGlucose.length > 0}}" class="record-list">
      <view class="record-item" wx:for="{{todayGlucose}}" wx:key="id">
        <view class="record-icon {{item.isAbnormal ? 'abnormal' : 'normal'}}">
          <text>{{item.measureType}}</text>
        </view>
        <view class="record-content">
          <view class="record-value {{item.isAbnormal ? 'text-danger' : 'text-success'}} text-number">
            {{item.value}}
            <text class="record-unit">mmol/L</text>
          </view>
          <view class="record-time">{{item.measureTime}}</view>
        </view>
        <view class="record-status">
          <view class="tag {{item.isAbnormal ? 'tag-abnormal' : 'tag-normal'}} tag-large">
            {{item.isAbnormal ? 'å¼‚å¸¸' : 'æ­£å¸¸'}}
          </view>
        </view>
      </view>
    </view>
    <view wx:else class="empty-state">
      <text class="empty-state-icon">ğŸ©¸</text>
      <text class="empty-state-text">ä»Šæ—¥æš‚æ— è¡€ç³–è®°å½•</text>
      <text class="empty-state-desc">ç‚¹å‡»"è®°å½•è¡€ç³–"å¼€å§‹è®°å½•</text>
    </view>
  </view>

  <!-- ä»Šæ—¥è¡€å‹è®°å½• -->
  <view class="card fade-in">
    <view class="card-header">
      <text class="card-title">ä»Šæ—¥è¡€å‹</text>
      <text class="view-all" bindtap="viewTrendPressure">æŸ¥çœ‹è¶‹åŠ¿ â€º</text>
    </view>
    <view wx:if="{{todayPressure.length > 0}}" class="record-list">
      <view class="record-item" wx:for="{{todayPressure}}" wx:key="id">
        <view class="record-icon {{item.isAbnormal ? 'abnormal' : 'normal'}}">
          <text>è¡€å‹</text>
        </view>
        <view class="record-content">
          <view class="record-value {{item.isAbnormal ? 'text-danger' : 'text-success'}} text-number">
            {{item.systolic}}/{{item.diastolic}}
            <text class="record-unit">mmHg</text>
          </view>
          <view class="record-time">{{item.measureTime}}</view>
        </view>
        <view class="record-status">
          <view class="tag {{item.isAbnormal ? 'tag-abnormal' : 'tag-normal'}} tag-large">
            {{item.isAbnormal ? 'å¼‚å¸¸' : 'æ­£å¸¸'}}
          </view>
        </view>
      </view>
    </view>
    <view wx:else class="empty-state">
      <text class="empty-state-icon">â¤ï¸</text>
      <text class="empty-state-text">ä»Šæ—¥æš‚æ— è¡€å‹è®°å½•</text>
      <text class="empty-state-desc">ç‚¹å‡»"è®°å½•è¡€å‹"å¼€å§‹è®°å½•</text>
    </view>
  </view>

  <!-- æœ€è¿‘è®°å½• -->
  <view class="card fade-in">
    <view class="card-header">
      <text class="card-title">æœ€è¿‘è®°å½•</text>
      <text class="view-all" bindtap="navigateToHistory">æŸ¥çœ‹å…¨éƒ¨ â€º</text>
    </view>
    <view wx:if="{{recentRecords.length > 0}}" class="record-list">
      <view class="record-item" wx:for="{{recentRecords}}" wx:key="id" bindtap="viewRecordDetail" data-item="{{item}}">
        <view class="record-icon {{item.isAbnormal ? 'abnormal' : 'normal'}}">
          <text>{{item.type === 'glucose' ? 'è¡€ç³–' : 'è¡€å‹'}}</text>
        </view>
        <view class="record-content">
          <view class="record-value {{item.isAbnormal ? 'text-danger' : 'text-success'}} text-number">
            <block wx:if="{{item.type === 'glucose'}}">{{item.value}} mmol/L</block>
            <block wx:else>{{item.systolic}}/{{item.diastolic}} mmHg</block>
          </view>
          <view class="record-time">{{item.measureTime}}</view>
        </view>
        <view class="record-status">
          <view class="tag {{item.isAbnormal ? 'tag-abnormal' : 'tag-normal'}} tag-large">
            {{item.isAbnormal ? 'å¼‚å¸¸' : 'æ­£å¸¸'}}
          </view>
        </view>
        <text class="list-item-arrow">â€º</text>
      </view>
    </view>
    <view wx:else class="empty-state">
      <text class="empty-state-icon">ğŸ“‹</text>
      <text class="empty-state-text">æš‚æ— è®°å½•</text>
      <text class="empty-state-desc">å¼€å§‹è®°å½•æ‚¨çš„å¥åº·æ•°æ®</text>
    </view>
  </view>
</view>
