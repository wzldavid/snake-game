<!--pages/history/index.wxml-->
<view class="container">
  <!-- é€‰é¡¹å¡ç­›é€‰ -->
  <view class="tabs">
    <view class="tab-item {{filterType === 'all' ? 'active' : ''}}" bindtap="selectFilter" data-type="all">
      å…¨éƒ¨
    </view>
    <view class="tab-item {{filterType === 'today' ? 'active' : ''}}" bindtap="selectFilter" data-type="today">
      ä»Šå¤©
    </view>
    <view class="tab-item {{filterType === 'week' ? 'active' : ''}}" bindtap="selectFilter" data-type="week">
      æœ¬å‘¨
    </view>
    <view class="tab-item {{filterType === 'month' ? 'active' : ''}}" bindtap="selectFilter" data-type="month">
      æœ¬æœˆ
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view wx:if="{{records.length > 0}}" class="record-list">
    <view class="record-group" wx:for="{{groupedRecords}}" wx:key="date">
      <view class="group-date text-sm text-secondary">{{item.date}}</view>
      <view class="record-card" wx:for="{{item.records}}" wx:for-item="record" wx:key="id">
        <view class="record-card-content">
          <view class="record-icon {{record.isAbnormal ? 'abnormal' : 'normal'}}">
            <text class="text-sm">{{record.type === 'glucose' ? 'è¡€ç³–' : 'è¡€å‹'}}</text>
          </view>
          <view class="record-content">
            <view class="record-header">
              <text class="record-type text-md">{{record.type === 'glucose' ? 'è¡€ç³–' : 'è¡€å‹'}}</text>
              <view class="tag {{record.isAbnormal ? 'tag-abnormal' : 'tag-normal'}}">
                {{record.isAbnormal ? 'å¼‚å¸¸' : 'æ­£å¸¸'}}
              </view>
            </view>
            <view class="record-value {{record.isAbnormal ? 'text-danger' : 'text-success'}} text-number">
              <block wx:if="{{record.type === 'glucose'}}">
                {{record.value}}
                <text class="record-unit text-sm">mmol/L</text>
                <text class="record-sub text-sm text-secondary">{{record.measureTypeText}}</text>
              </block>
              <block wx:else>
                {{record.systolic}}/{{record.diastolic}}
                <text class="record-unit text-sm">mmHg</text>
                <text wx:if="{{record.heartRate}}" class="record-sub text-sm text-secondary">
                  å¿ƒç‡: {{record.heartRate}} æ¬¡/åˆ†
                </text>
              </block>
            </view>
            <view class="record-time text-sm text-secondary">{{record.time}}</view>
          </view>
        </view>
        <view class="record-actions">
          <button class="btn btn-text delete-btn" bindtap="deleteRecord" data-id="{{record.id}}" data-type="{{record.type}}">
            åˆ é™¤
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-state">
    <text class="empty-state-icon">ğŸ“‹</text>
    <text class="empty-state-text text-md">æš‚æ— è®°å½•</text>
    <text class="empty-state-desc text-sm text-secondary">å¼€å§‹è®°å½•æ‚¨çš„å¥åº·æ•°æ®</text>
    <view class="empty-actions">
      <button class="btn btn-primary btn-primary-medium" bindtap="navigateToRecordGlucose">è®°å½•è¡€ç³–</button>
      <button class="btn btn-primary btn-primary-medium" bindtap="navigateToRecordPressure">è®°å½•è¡€å‹</button>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{hasMore && records.length > 0}}" class="load-more text-sm text-secondary" bindtap="loadMore">
    åŠ è½½æ›´å¤š
  </view>
</view>
