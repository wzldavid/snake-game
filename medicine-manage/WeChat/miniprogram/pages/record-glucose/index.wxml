<!--pages/record-glucose/index.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">记录血糖</text>
    <text class="page-subtitle">手动输入或拍照识别</text>
  </view>

  <!-- 血糖值输入 -->
  <view class="card fade-in">
    <view class="card-title text-lg">血糖值</view>
    <view class="input-section">
      <input 
        class="input-large text-number" 
        type="digit" 
        placeholder="请输入血糖值" 
        value="{{glucoseValue}}"
        bindinput="onGlucoseInput"
        focus="{{focus}}"
      />
      <text class="input-unit text-md">mmol/L</text>
    </view>
    <view class="input-tip text-sm text-secondary">
      正常范围: 3.9-6.1 mmol/L (空腹)
    </view>
  </view>

  <!-- 测量时间类型 -->
  <view class="card fade-in">
    <view class="card-title text-lg">测量时段</view>
    <view class="radio-group">
      <view class="radio-item {{measureType === 1 ? 'active' : ''}}" bindtap="selectMeasureType" data-type="1">
        <view class="radio-label">空腹</view>
      </view>
      <view class="radio-item {{measureType === 2 ? 'active' : ''}}" bindtap="selectMeasureType" data-type="2">
        <view class="radio-label">早餐后</view>
      </view>
      <view class="radio-item {{measureType === 3 ? 'active' : ''}}" bindtap="selectMeasureType" data-type="3">
        <view class="radio-label">午餐后</view>
      </view>
      <view class="radio-item {{measureType === 4 ? 'active' : ''}}" bindtap="selectMeasureType" data-type="4">
        <view class="radio-label">晚餐后</view>
      </view>
      <view class="radio-item {{measureType === 5 ? 'active' : ''}}" bindtap="selectMeasureType" data-type="5">
        <view class="radio-label">睡前</view>
      </view>
    </view>
  </view>

  <!-- 测量时间 -->
  <view class="card fade-in">
    <view class="card-title text-lg">测量时间</view>
    <picker mode="time" value="{{measureTime}}" bindchange="onTimeChange">
      <view class="picker">
        <text class="picker-text text-md">{{measureTime || '请选择测量时间'}}</text>
        <text class="picker-arrow text-xl">›</text>
      </view>
    </picker>
  </view>

  <!-- 照片识别 -->
  <view class="card fade-in">
    <view class="card-title text-lg">快速记录</view>
    <view class="photo-actions">
      <button class="photo-btn" bindtap="takePhoto">
        <text class="photo-icon">📷</text>
        <text class="photo-text text-md">拍照识别</text>
      </button>
      <button class="photo-btn" bindtap="chooseFromAlbum">
        <text class="photo-icon">🖼️</text>
        <text class="photo-text text-md">相册选择</text>
      </button>
    </view>
    <view wx:if="{{photoUrl}}" class="photo-preview">
      <image src="{{photoUrl}}" mode="aspectFit" class="preview-image"></image>
      <view class="photo-remove" bindtap="removePhoto">
        <text class="text-lg">✕</text>
      </view>
    </view>
    <view wx:if="{{recognizing}}" class="recognizing">
      <text class="text-md">AI识别中,请稍候...</text>
    </view>
  </view>

  <!-- 底部按钮 -->
  <view class="bottom-actions safe-area-bottom">
    <button class="btn btn-secondary btn-primary-large" bindtap="onCancel">取消</button>
    <button class="btn btn-primary btn-primary-large" bindtap="onSave">保存记录</button>
  </view>
</view>
