<!--pages/trend-pressure/index.wxml-->
<view class="container">
  <!-- 统计网格 -->
  <view class="stats-grid">
    <view class="stat-item fade-in">
      <text class="stat-label text-sm text-secondary">平均血压</text>
      <text class="stat-value text-lg text-number">{{statistics.avgSystolic}}/{{statistics.avgDiastolic}}</text>
      <text class="stat-unit text-sm text-secondary">mmHg</text>
    </view>
    <view class="stat-item fade-in">
      <text class="stat-label text-sm text-secondary">平均心率</text>
      <text class="stat-value text-lg text-number">{{statistics.avgHeartRate}}</text>
      <text class="stat-unit text-sm text-secondary">次/分</text>
    </view>
    <view class="stat-item fade-in">
      <text class="stat-label text-sm text-secondary">最高血压</text>
      <text class="stat-value text-lg text-danger text-number">{{statistics.maxSystolic}}/{{statistics.maxDiastolic}}</text>
      <text class="stat-unit text-sm text-secondary">mmHg</text>
    </view>
    <view class="stat-item fade-in">
      <text class="stat-label text-sm text-secondary">异常次数</text>
      <text class="stat-value text-lg {{statistics.abnormalCount > 0 ? 'text-danger' : 'text-success'}} text-number">
        {{statistics.abnormalCount}}
      </text>
      <text class="stat-unit text-sm text-secondary">次</text>
    </view>
  </view>

  <!-- 图表卡片 -->
  <view class="card fade-in">
    <view class="card-header">
      <text class="card-title text-lg">血压趋势</text>
    </view>
    <!-- 时间筛选器 -->
    <view class="time-filter">
      <view class="filter-item {{timeRange === 7 ? 'active' : ''}}" bindtap="changeTimeRange" data-days="7">
        <text class="filter-text">7天</text>
      </view>
      <view class="filter-item {{timeRange === 15 ? 'active' : ''}}" bindtap="changeTimeRange" data-days="15">
        <text class="filter-text">15天</text>
      </view>
      <view class="filter-item {{timeRange === 30 ? 'active' : ''}}" bindtap="changeTimeRange" data-days="30">
        <text class="filter-text">30天</text>
      </view>
    </view>
    <!-- 图例 -->
    <view class="chart-legend">
      <view class="legend-item">
        <view class="legend-color legend-systolic"></view>
        <text class="legend-text text-sm">● 收缩压(高压)</text>
      </view>
      <view class="legend-item">
        <view class="legend-color legend-diastolic"></view>
        <text class="legend-text text-sm">● 舒张压(低压)</text>
      </view>
      <view class="legend-item">
        <view class="legend-color legend-heart"></view>
        <text class="legend-text text-sm">● 脉搏(心率)</text>
      </view>
    </view>
    <scroll-view scroll-x="true" class="chart-scroll">
      <canvas canvas-id="pressureChart" class="chart-canvas"></canvas>
    </scroll-view>
  </view>

  <!-- 数据明细 -->
  <view class="card fade-in">
    <view class="card-header">
      <text class="card-title text-lg">数据明细</text>
    </view>
    <view class="data-list">
      <view class="data-item" wx:for="{{chartData}}" wx:key="date">
        <view class="data-date text-md">{{item.date}}</view>
        <view class="data-values">
          <view class="data-value-group">
            <text class="data-value-label text-xs text-secondary">收缩压</text>
            <text class="data-value text-primary text-number">{{item.systolic}}</text>
          </view>
          <view class="data-value-group">
            <text class="data-value-label text-xs text-secondary">舒张压</text>
            <text class="data-value text-warning text-number">{{item.diastolic}}</text>
          </view>
          <view class="data-value-group">
            <text class="data-value-label text-xs text-secondary">心率</text>
            <text class="data-value text-danger text-number">{{item.heartRate}}</text>
          </view>
        </view>
        <view wx:if="{{item.isAbnormal}}" class="data-abnormal tag tag-abnormal">⚠️ 异常</view>
      </view>
    </view>
  </view>
</view>
