<!--pages/trend-glucose/index.wxml-->
<view class="container">
  <!-- 统计卡片网格 -->
  <view class="stats-grid">
    <view class="stat-item fade-in">
      <text class="stat-label text-sm text-secondary">空腹平均</text>
      <text class="stat-value text-lg text-primary text-number">{{statistics.avgFasting}}</text>
      <text class="stat-unit text-sm text-secondary">mmol/L</text>
    </view>
    <view class="stat-item fade-in">
      <text class="stat-label text-sm text-secondary">餐后平均</text>
      <text class="stat-value text-lg text-warning text-number">{{statistics.avgPostprandial}}</text>
      <text class="stat-unit text-sm text-secondary">mmol/L</text>
    </view>
    <view class="stat-item fade-in">
      <text class="stat-label text-sm text-secondary">最高值</text>
      <text class="stat-value text-lg text-danger text-number">{{statistics.max}}</text>
      <text class="stat-unit text-sm text-secondary">mmol/L</text>
    </view>
    <view class="stat-item fade-in">
      <text class="stat-label text-sm text-secondary">异常次数</text>
      <text class="stat-value text-lg {{statistics.abnormalCount > 0 ? 'text-danger' : 'text-success'}} text-number">
        {{statistics.abnormalCount}}
      </text>
      <text class="stat-unit text-sm text-secondary">次</text>
    </view>
  </view>

  <!-- 图表卡片 -->
  <view class="card fade-in">
    <view class="card-header">
      <text class="card-title text-lg">血糖趋势(最近30天)</text>
    </view>
    <!-- 图例 -->
    <view class="chart-legend">
      <view class="legend-item">
        <view class="legend-color legend-fasting"></view>
        <text class="legend-text text-sm">● 空腹血糖</text>
      </view>
      <view class="legend-item">
        <view class="legend-color legend-postprandial"></view>
        <text class="legend-text text-sm">● 餐后血糖</text>
      </view>
    </view>
    <scroll-view scroll-x="true" class="chart-scroll">
      <canvas canvas-id="glucoseChart" class="chart-canvas"></canvas>
    </scroll-view>
  </view>

  <!-- 数据明细 -->
  <view class="card fade-in">
    <view class="card-header">
      <text class="card-title text-lg">数据明细</text>
    </view>
    <view class="data-list">
      <view class="data-item" wx:for="{{chartData}}" wx:key="id">
        <view class="data-date text-md">{{item.date}}</view>
        <view class="data-values">
          <view class="data-value-group">
            <text class="data-value-label text-xs text-secondary">空腹</text>
            <text class="data-value text-primary text-number">{{item.fastingValue || '-'}}</text>
          </view>
          <view class="data-value-group">
            <text class="data-value-label text-xs text-secondary">餐后</text>
            <text class="data-value text-warning text-number">{{item.postprandialValue || '-'}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
