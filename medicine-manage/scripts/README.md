# 测试数据导入说明

本目录包含测试数据生成和导入脚本,用于创建老人健康记录小程序的测试数据。

## 快速开始

### 1. 生成测试数据

```bash
node generateTestData.js
```

这将生成两个用户(张大爷、刘大妈)的30天血糖和血压测试数据:
- 2个用户记录
- 约157条血糖记录
- 约87条血压记录

生成的数据保存在 `../cloud-database-test-data.json`

### 2. 导入数据到CloudBase

#### 方法一: 使用Node.js脚本导入(推荐)

1. 安装依赖:
```bash
cd d:/project/medicine-manage
npm install @cloudbase/node-sdk
```

2. 配置CloudBase:
```bash
npm install -g @cloudbase/cli
cloudbase login
```

3. 运行导入脚本:
```bash
cd scripts
node importTestData.js
```

可选参数:
- `--no-clear`: 不清空已有数据
- `--help`: 显示帮助信息

#### 方法二: 使用云开发控制台手动导入

1. 登录腾讯云开发控制台: https://console.cloud.tencent.com/tcb
2. 选择环境: `wzldavid-4gwhey9fe011d906`
3. 进入"数据库"管理页面
4. 分别导入以下集合:
   - `users`: 导入 `cloud-database-test-data.json` 中的 `users` 数组
   - `blood_glucose`: 导入 `blood_glucose` 数组
   - `blood_pressure`: 导入 `blood_pressure` 数组

导入时确保字段名称和类型与数据库结构一致。

## 测试数据说明

### 用户信息

**张大爷**
- 年龄: 70岁
- 性别: 男
- 糖尿病: 是
- 高血压: 是
- 血糖记录: 77条
- 血压记录: 42条

**刘大妈**
- 年龄: 67岁
- 性别: 女
- 糖尿病: 是
- 高血压: 否
- 血糖记录: 80条
- 血压记录: 45条

### 数据特点

1. **时间范围**: 过去30天的数据(2026-01-01 ~ 2026-01-31)
2. **异常数据**:
   - 异常血糖: 约7% (11条)
   - 异常血压: 约13% (11条)
3. **血糖测量类型**: 空腹、早餐后、午餐后、晚餐后、睡前
4. **血压记录**: 包含收缩压、舒张压和心率数据

### 数据验证

数据生成时会自动判断异常值:

**血糖异常判断**:
- 正常人: 空腹 3.9-6.1 mmol/L
- 糖尿病患者: 空腹 4.4-7.0 mmol/L
- 低血糖: < 3.9 mmol/L

**血压异常判断**:
- 高血压: 收缩压 > 140 或 舒张压 > 90 mmHg
- 低血压: 收缩压 < 90 或 舒张压 < 60 mmHg

## 常见问题

### Q1: 导入失败,提示用户不存在

**原因**: CloudBase环境配置错误或未登录

**解决方案**:
1. 确认环境ID正确: `wzldavid-4gwhey9fe011d906`
2. 运行 `cloudbase login` 重新登录
3. 检查网络连接

### Q2: 数据库权限错误

**原因**: 数据库安全规则未配置

**解决方案**:
1. 参考项目根目录的 `WeChat/cloud-database-security.json`
2. 在云开发控制台手动配置安全规则
3. 或临时设置为所有用户可读写(仅用于测试)

### Q3: 批量导入失败

**原因**: 单次导入数据过多或网络不稳定

**解决方案**:
- 脚本已内置分批导入功能(每批100条)
- 如果仍然失败,会自动切换为逐条导入
- 检查网络连接和CloudBase服务状态

## 测试场景

使用这些测试数据,可以测试以下功能:

1. **数据展示**:
   - ✅ 首页健康数据概览
   - ✅ 历史记录列表
   - ✅ 趋势图表展示

2. **数据记录**:
   - ✅ 手动输入血糖/血压
   - ✅ 照片识别记录
   - ✅ 数据修改和删除

3. **数据分析**:
   - ✅ 异常值检测和预警
   - ✅ 血糖/血压趋势分析
   - ✅ 统计数据计算

4. **用户管理**:
   - ✅ 个人信息查看和编辑
   - ✅ 紧急联系人管理

## 注意事项

1. ⚠️ 测试数据仅用于开发测试,请勿在生产环境使用
2. ⚠️ 导入前建议备份现有数据
3. ⚠️ 使用 `--no-clear` 参数可避免清空现有数据
4. ⚠️ 测试数据的 openid 格式为 `test_openid_{nickname}_{id}`,仅用于测试

## 相关文件

- `generateTestData.js`: 测试数据生成脚本
- `importTestData.js`: CloudBase数据库导入脚本
- `../cloud-database-test-data.json`: 生成的测试数据文件
- `../WeChat/cloud-database-security.json`: 数据库安全规则配置
