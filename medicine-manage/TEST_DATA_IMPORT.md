# 🧪 导入张大爷测试数据 - 操作指南

## ✅ 已完成
- ✅ 创建 `importTestData` 云函数
- ✅ 添加测试数据导入按钮到小程序"我的"页面
- ✅ 依赖包已安装

---

## 🚀 快速开始(3步)

### 第1步: 部署云函数 ⏱️ 1分钟

在微信开发者工具中:
1. 找到 `WeChat/cloudfunctions/importTestData` 文件夹
2. 右键点击 `importTestData`
3. 选择 **"上传并部署:云端安装依赖"**
4. 等待部署完成(约30秒)

**✅ 确认**: 控制台显示"上传并部署成功"

---

### 第2步: 在小程序中导入数据 ⏱️ 1分钟

1. 打开小程序,进入 **"我的"** 页面
2. 滚动到底部,看到 **"测试功能"** 区域
3. 点击 **"导入张大爷测试数据"** 按钮
4. 确认导入

**✅ 确认**: 显示导入成功,包含数据统计:
- 用户: 1条
- 血糖: 5条
- 血压: 5条

---

### 第3步: 验证数据 ⏱️ 2分钟

#### 3.1 检查用户信息
- 用户名显示: **"张大爷"**
- 性别: **男**
- 年龄: **70岁**
- 糖尿病: **已患病**
- 高血压: **已患病**

#### 3.2 检查血糖记录
1. 点击 **"血糖趋势"**
2. 查看图表,应该有5条记录
3. 包含: 空腹、午餐后、晚餐后等数据

#### 3.3 检查血压记录
1. 点击 **"血压趋势"**
2. 查看图表,应该有5条记录
3. 包含: 收缩压、舒张压、心率数据

---

## 📊 导入的数据详情

### 用户信息
```json
{
  "nickname": "张大爷",
  "gender": 1,           // 男
  "age": 70,
  "birthday": "1955-03-15",
  "hasDiabetes": true,   // 糖尿病
  "hasHypertension": true // 高血压
}
```

### 血糖记录(5条)
| 日期 | 类型 | 数值 | 是否异常 |
|------|------|------|----------|
| 2026-01-31 | 午餐后 | 5.8 | 否 |
| 2026-01-31 | 空腹 | 4.9 | 否 |
| 2026-01-31 | 晚餐后 | 6.2 | 否 |
| 2026-01-30 | 午餐后 | 7.1 | 是(偏高) |
| 2026-01-30 | 空腹 | 5.2 | 否 |

### 血压记录(5条)
| 日期 | 收缩压 | 舒张压 | 心率 | 是否异常 |
|------|--------|--------|------|----------|
| 2026-01-31 | 128 | 82 | 72 | 否 |
| 2026-01-30 | 135 | 88 | 76 | 是(偏高) |
| 2026-01-29 | 125 | 80 | 70 | 否 |
| 2026-01-28 | 130 | 85 | 74 | 否 |
| 2026-01-27 | 122 | 78 | 68 | 否 |

---

## 🔧 功能说明

### 云函数功能
- **自动清理旧数据**: 导入前会清除张大爷的旧数据
- **批量导入**: 一次性导入用户、血糖、血压数据
- **错误处理**: 导入失败会显示详细错误信息

### 小程序按钮
- **位置**: "我的"页面底部
- **显示条件**: `isDev: true` (可修改隐藏)
- **操作流程**: 点击 → 确认 → 导入 → 刷新数据

---

## 🚨 常见问题

### Q1: 找不到"测试功能"按钮?
**解决**:
- 检查 `profile/index.js` 中 `isDev: true`
- 如果设置为 `false`,按钮不会显示
- 滚动到"我的"页面最底部

### Q2: 导入失败,提示"云函数未部署"?
**解决**:
- 在微信开发者工具中右键 `importTestData` 文件夹
- 选择"上传并部署:云端安装依赖"
- 等待部署完成

### Q3: 导入后数据没显示?
**解决**:
- 下拉刷新页面
- 或重新进入"我的"页面
- 检查云开发控制台数据库是否有数据

### Q4: 多次导入会重复数据吗?
**解决**:
- 不会,云函数会先清理旧数据
- 每次导入都是全新的数据

---

## 📝 手动测试场景

### 场景1: 新用户首次导入
1. 清除小程序缓存
2. 打开小程序,进入"我的"
3. 点击"导入张大爷测试数据"
4. ✅ 验证: 显示张大爷信息

### 场景2: 查看血糖趋势
1. 导入数据后,点击"血糖趋势"
2. ✅ 验证: 显示5条血糖记录的折线图
3. ✅ 验证: 异常数据(7.1)标记为红色

### 场景3: 查看血压趋势
1. 点击"血压趋势"
2. ✅ 验证: 显示5条血压记录的折线图
3. ✅ 验证: 收缩压、舒张压两条线
4. ✅ 验证: 显示心率数据

### 场景4: 编辑用户资料
1. 点击"编辑"按钮
2. 修改昵称为"张大爷测试"
3. 保存
4. ✅ 验证: 保存成功,昵称已更新

### 场景5: 添加新记录
1. 进入首页
2. 点击"+"添加血糖记录
3. 输入数值,保存
4. ✅ 验证: 记录显示在列表中

---

## 📁 相关文件

### 云函数
- `WeChat/cloudfunctions/importTestData/index.js` - 云函数主文件
- `WeChat/cloudfunctions/importTestData/package.json` - 依赖配置

### 小程序页面
- `WeChat/miniprogram/pages/profile/index.js` - 添加 `importTestData()` 方法
- `WeChat/miniprogram/pages/profile/index.wxml` - 添加测试按钮UI
- `WeChat/miniprogram/pages/profile/index.wxss` - 添加测试按钮样式

---

## 🎯 完成检查清单

- [ ] 部署 `importTestData` 云函数
- [ ] 在小程序"我的"页面看到测试按钮
- [ ] 点击导入按钮,导入成功
- [ ] 用户信息显示"张大爷"
- [ ] 血糖趋势显示5条记录
- [ ] 血压趋势显示5条记录
- [ ] 可以查看血糖趋势图
- [ ] 可以查看血压趋势图
- [ ] 可以编辑用户资料
- [ ] 可以添加新的健康记录

---

## 🎉 完成!

测试数据导入功能已准备就绪!

**预计总时间: 3-5分钟**

**下一步**:
1. 部署云函数(1分钟)
2. 导入测试数据(1分钟)
3. 开始手动测试(2分钟)

**开始测试吧!** 🚀
